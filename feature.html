<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Netzwerk-Topologie Editor - n8n Landing</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <style>
    /* Animated GIF Background */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background-image: url('https://media.giphy.com/media/eg95n5O5SsQ1V4qhsW/giphy.gif');
      background-size: cover; background-position: center; background-repeat: no-repeat;
      background-attachment: fixed; z-index: -2;
    }
    /* Dark overlay for better contrast */
    body::after {
      content: '';
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); z-index: -1;
    }
    body { background: transparent; position: relative; }

    /* Responsive Navigation Menu Styles */
    nav {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        padding: 20px 10px;
        background: rgba(0, 0, 0, 0.8);
        border-bottom: 2px solid #39ff14;
    }

    nav a {
        color: #39ff14;
        text-decoration: none;
        padding: 10px 20px;
        border: 2px solid #39ff14;
        border-radius: 5px;
        transition: all 0.3s ease;
        font-size: 16px;
        white-space: nowrap;
    }

    nav a:hover {
        background: #39ff14;
        color: #000;
        box-shadow: 0 0 15px #39ff14;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
        nav {
            flex-direction: column;
            gap: 10px;
            padding: 15px 10px;
        }
        
        nav a {
            width: 90%;
            text-align: center;
            font-size: 14px;
        }
    }

    @media (max-width: 480px) {
        nav a {
            padding: 8px 15px;
            font-size: 13px;
        }
    }

    .topology-container { display:flex; flex-direction:column; min-height:100vh; background:transparent; }
    .topology-header { padding:20px; background: rgba(0,0,0,0.5); border-bottom:2px solid #39ff14; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
    .topology-header h1 { color:#39ff14; text-shadow:0 0 20px #39ff14; margin:0; font-size:1.8rem; }
    .topology-controls { display:flex; gap:10px; flex-wrap:wrap; }
    .topology-btn { background: linear-gradient(135deg,#39ff14 0%,#00ff88 100%); border:none; padding:10px 20px; border-radius:5px; color:#000; cursor:pointer; }
    .hint { color:#ccc; font-size:0.9rem; }
    /* Optional CSS glow if connections are rendered as SVG/Canvas mirror */
    .neon-connection { stroke:#39ff14; filter: drop-shadow(0 0 6px #39ff14) drop-shadow(0 0 12px #39ff14); }
  </style>
  <script src="https://unpkg.com/konva@9/konva.min.js"></script>
</head>
<body>
  <!-- Navigation Menu -->
  <nav>
    <a href="index.html">Home</a>
    <a href="feature.html">ðŸ”Œ Netzwerk Editor</a>
    <a href="/n8n/" target="_blank">Admin Bereich</a>
  </nav>

  <div class="topology-container">
    <header class="topology-header">
      <h1>Netzwerk-Topologie Editor</h1>
      <div class="topology-controls">
        <button id="clear-btn" class="topology-btn">Leeren</button>
        <button id="export-btn" class="topology-btn">Exportieren</button>
      </div>
    </header>
    <div id="palette" style="padding:12px; display:flex; gap:12px; flex-wrap:wrap;">
      <button class="topology-btn device-item" data-device="router">Router</button>
      <button class="topology-btn device-item" data-device="switch">Switch</button>
      <button class="topology-btn device-item" data-device="pc">PC</button>
      <button class="topology-btn device-item" data-device="server">Server</button>
      <span class="hint">Tipp: Linksklick auf zwei GerÃ¤te, um zu verbinden.</span>
    </div>
    <div id="stage-wrapper" style="flex:1; min-height:60vh;"></div>
  </div>
  <script>
    const wrapper = document.getElementById('stage-wrapper');
    const stage = new Konva.Stage({ container: 'stage-wrapper', width: wrapper.clientWidth, height: Math.max(600, window.innerHeight * 0.7) });
    const layer = new Konva.Layer();
    stage.add(layer);
    let connections = [];
    let nodes = [];
    let pendingDevice = null; // stores first clicked device for simple left-click connect
    function createDevice(type, x, y) {
      const group = new Konva.Group({ x, y, draggable: true });
      const base = new Konva.Rect({ width: 80, height: 50, fill: 'rgba(0,0,0,0.6)', stroke: '#39ff14', strokeWidth: 2, cornerRadius: 8, shadowColor: '#39ff14', shadowBlur: 8, shadowOpacity: 0.8 });
      const label = new Konva.Text({ text: type.toUpperCase(), fontSize: 14, fill: '#39ff14', align: 'center', width: 80, y: 16, shadowColor: '#39ff14', shadowBlur: 6, shadowOpacity: 0.7 });
      group.add(base); group.add(label);
      layer.add(group); layer.draw();
      // Simple left-click connection logic (Shift key removed)
      group.on('click', () => {
        if (!pendingDevice) {
          pendingDevice = group;
          base.stroke('#ff6600'); base.strokeWidth(3); layer.draw();
        } else if (pendingDevice !== group) {
          createConnection(pendingDevice, group);
          pendingDevice.getChildren()[0].stroke('#39ff14'); pendingDevice.getChildren()[0].strokeWidth(2);
          pendingDevice = null;
          layer.draw();
        }
      });
      group.on('dragmove', updateConnections);
      nodes.push(group);
      return group;
    }
    function createConnection(device1, device2) {
      const line = new Konva.Line({
        points: [device1.x(), device1.y(), device2.x(), device2.y()],
        stroke: '#39ff14',
        strokeWidth: 3,
        opacity: 0.95,
        shadowColor: '#39ff14',
        shadowBlur: 18,    // stronger neon glow
        shadowOpacity: 1,
        lineCap: 'round',
        lineJoin: 'round'
      });
      connections.push({ line, device1, device2 });
      layer.add(line);
      line.moveToBottom();
      layer.draw();
    }
    function updateConnections() {
      connections.forEach(conn => {
        conn.line.points([conn.device1.x(), conn.device1.y(), conn.device2.x(), conn.device2.y()]);
      });
      layer.draw();
    }
    // Palette add
    document.querySelectorAll('.device-item').forEach(item => {
      item.addEventListener('click', () => {
        const type = item.dataset.device;
        createDevice(type, 150 + Math.random() * 200, 150 + Math.random() * 200);
      });
    });
    // Clear
    document.getElementById('clear-btn').addEventListener('click', () => {
      if (confirm('Alle GerÃ¤te und Verbindungen lÃ¶schen?')) {
        layer.destroyChildren();
        connections = []; nodes = []; pendingDevice = null;
        layer.draw();
      }
    });
    // Export
    document.getElementById('export-btn').addEventListener('click', () => {
      const dataURL = stage.toDataURL({ pixelRatio: 2 });
      const link = document.createElement('a');
      link.download = 'netzwerk-topologie.png';
      link.href = dataURL; document.body.appendChild(link); link.click(); document.body.removeChild(link);
    });
    // Example topology
    setTimeout(() => {
      const r = createDevice('router', 400, 200);
      const s1 = createDevice('switch', 300, 350);
      const s2 = createDevice('switch', 500, 350);
      const pc1 = createDevice('pc', 200, 500);
      const pc2 = createDevice('pc', 400, 500);
      const srv = createDevice('server', 600, 500);
      createConnection(r, s1);
      createConnection(r, s2);
      createConnection(s1, pc1);
      createConnection(s1, pc2);
      createConnection(s2, srv);
    }, 100);
    window.addEventListener('resize', () => {
      stage.size({ width: wrapper.clientWidth, height: Math.max(600, window.innerHeight * 0.7) });
      updateConnections();
    });
  </script>
</body>
</html>
