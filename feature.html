<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Netzwerk-Topologie Editor - n8n Landing</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <style>
    /* Animated GIF Background */
    body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: url('https://media.giphy.com/media/eg95n5O5SsQ1V4qhsW/giphy.gif'); background-size: cover; background-position: center; background-repeat: no-repeat; background-attachment: fixed; z-index: -2; }
    /* Dark overlay for better contrast */
    body::after { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: -1; }
    body { background: transparent; position: relative; }
    /* Responsive Navigation Menu Styles */
    nav {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        padding: 20px 10px;
        background: rgba(0, 0, 0, 0.8);
        border-bottom: 2px solid #39ff14;
    }
    nav a {
        color: #39ff14;
        text-decoration: none;
        padding: 10px 20px;
        border: 2px solid #39ff14;
        border-radius: 5px;
        transition: all 0.3s ease;
        font-size: 16px;
        white-space: nowrap;
    }
    nav a:hover {
        background: #39ff14;
        color: #000;
        box-shadow: 0 0 15px #39ff14;
    }
    /* Mobile responsiveness */
    @media (max-width: 768px) {
        nav {
            flex-direction: column;
            gap: 10px;
            padding: 15px 10px;
        }
        
        nav a {
            width: 90%;
            text-align: center;
            font-size: 14px;
        }
    }
    @media (max-width: 480px) {
        nav a {
            padding: 8px 15px;
            font-size: 13px;
        }
    }
    .topology-container { display:flex; flex-direction:column; min-height:100vh; background:transparent; }
    .topology-header { padding:20px; background: rgba(0,0,0,0.5); border-bottom:2px solid #39ff14; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
    .topology-header h1 { color:#39ff14; text-shadow:0 0 20px #39ff14; margin:0; font-size:1.8rem; }
    .topology-controls { display:flex; gap:10px; flex-wrap:wrap; }
    .topology-btn { background: linear-gradient(135deg,#39ff14 0%,#00ff88 100%); border:none; padding:10px 20px; border-radius:5px; color:#000; cursor:pointer; }
    .hint { color:#ccc; font-size:0.9rem; }
    /* Optional CSS glow if connections are rendered as SVG/Canvas mirror */
    .neon-connection { stroke:#39ff14; filter: drop-shadow(0 0 6px #39ff14) drop-shadow(0 0 12px #39ff14); }
  </style>
</head>
<body>
  <!-- Embedded Navigation Menu -->
  <nav>
    <a href="index.html">Home</a>
    <a href="feature.html">ðŸ”Œ Netzwerk Editor</a>
    <a href="/n8n/" target="_blank">Admin Bereich</a>
  </nav>

  <div class="topology-container">
    <div class="topology-header">
      <h1>ðŸ”Œ Netzwerk-Topologie Editor</h1>
      <div class="topology-controls">
        <button class="topology-btn" onclick="addNode()">+ Add Node</button>
        <button class="topology-btn" onclick="clearNodes()">Clear All</button>
        <button class="topology-btn" onclick="saveTopology()">Save Topology</button>
        <button class="topology-btn" onclick="loadTopology()">Load Topology</button>
      </div>
    </div>
    <div class="hint">Linksklick auf einen Node, dann Linksklick auf einen anderen Node: Beide werden verbunden (Neon-Linie).</div>
    <div id="cy" style="width:100%; height:calc(100vh - 180px);"></div>
  </div>

  <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
  <script>
    let cy;
    let nodeCounter = 1;
    let firstSelected = null;

    document.addEventListener('DOMContentLoaded', () => {
      cy = cytoscape({
        container: document.getElementById('cy'),
        style: [
          {
            selector: 'node',
            style: {
              'label': 'data(id)',
              'text-valign': 'center',
              'color': '#39ff14',
              'background-color': '#000',
              'border-width': 3,
              'border-color': '#39ff14',
              'width': 50,
              'height': 50,
              'font-size': 14,
              'text-outline-width': 2,
              'text-outline-color': '#000'
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 4,
              'line-color': '#39ff14',
              'target-arrow-color': '#39ff14',
              'target-arrow-shape': 'triangle',
              'curve-style': 'bezier',
              'opacity': 0.9
            }
          },
          {
            selector: 'node:selected',
            style: {
              'border-color': '#00ff88',
              'border-width': 5
            }
          }
        ],
        layout: { name: 'preset' }
      });

      cy.on('tap', 'node', function(evt) {
        const node = evt.target;
        if (!firstSelected) {
          firstSelected = node;
          node.style('border-color', '#00ff88');
        } else {
          if (firstSelected.id() !== node.id()) {
            cy.add({
              group: 'edges',
              data: {
                source: firstSelected.id(),
                target: node.id()
              }
            });
          }
          firstSelected.style('border-color', '#39ff14');
          firstSelected = null;
        }
      });

      cy.on('tap', function(evt) {
        if (evt.target === cy) {
          if (firstSelected) {
            firstSelected.style('border-color', '#39ff14');
            firstSelected = null;
          }
        }
      });
    });

    function addNode() {
      const nodeId = 'node' + nodeCounter++;
      cy.add({
        group: 'nodes',
        data: { id: nodeId },
        position: { x: Math.random() * 600 + 100, y: Math.random() * 400 + 100 }
      });
    }

    function clearNodes() {
      cy.elements().remove();
      firstSelected = null;
      nodeCounter = 1;
    }

    function saveTopology() {
      const json = cy.json();
      const blob = new Blob([JSON.stringify(json, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'topology.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function loadTopology() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'application/json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const json = JSON.parse(event.target.result);
            cy.json(json);
          } catch (err) {
            alert('Invalid topology file');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }
  </script>
</body>
</html>
